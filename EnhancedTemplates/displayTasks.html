

{% extends "base.html" %}

{% block title %}TO DO LIST{% endblock %}

{% block content %}

<h1>TODAY'S TASKS FOR {{ user.username | upper }}!</h1>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    {% for message in messages %}
      <div id="flashed-message">{{ message|safe }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<form action="{{ url_for('addTask', username=user.username) }}" method="POST">
  <input type="text" name="task" placeholder="Task" required>
  <input type="number" name="priority" placeholder="Priority (optional)">
  <textarea rows="4" cols="50" name="description" placeholder="Description (optional)"></textarea>
  <input type="submit" value="Add Task">
</form>

{% if remainingTasks %}
  <h2>Remaining Tasks</h2>
  {% for task in remainingTasks %}
    <li class="remaining-task">

      <div class="task-name">
        <a href="{{ url_for('elaborateTask', tid=task.tid) }}">{{ task.task }}</a>
      </div>

      <div class="task-priority">Priority: {{ task.priority }}</div>

      <div class="task-options">
        <form action="{{ url_for('editTask', tid=task.tid) }}" method="GET">
          <button type="submit">Edit</button>
        </form>
        <form action="{{ url_for('markWorkingOn', tid=task.tid) }}" method="POST">
          <button type="submit">Mark Working</button>
        </form>
        <form action="{{ url_for('markComplete', tid=task.tid) }}" method="POST">
          <button type="submit">Complete</button>
        </form>
        <form action="{{ url_for('deleteTask', tid=task.tid) }}" method="POST">
          <button type="submit">Delete</button>
        </form>
      </div>
    </li>
  {% endfor %}
{% endif %}

{% if workingOnTasks %}
  <h2>Working On</h2>
  {% for task in workingOnTasks %}
    <li class="working-task">
      <div class="task-name">
        <a href="{{ url_for('elaborateTask', tid=task.tid) }}">{{ task.task }}</a>
      </div>
      <div class="task-priority">Priority: {{ task.priority }}</div>
      <div class="task-options">

        <form action="{{ url_for('editTask', tid=task.tid) }}" method="GET">
          <button type="submit">Edit</button>
        </form>

        <form action="{{ url_for('markIncomplete', tid=task.tid) }}" method="POST">
          <button type="submit">Return To Tasks</button>
        </form>

        <form action="{{ url_for('markComplete', tid=task.tid) }}" method="POST">
          <button type="submit">Complete</button>
        </form>

        <form action="{{ url_for('deleteTask', tid=task.tid) }}" method="POST">
          <button type="submit">Delete</button>
        </form>

      </div>
    </li>
  {% endfor %}
{% endif %}

{% if completedTasks %}
  <h2>Completed Tasks</h2>
  {% for task in completedTasks %}
    <li class="completed-task">

      <div class="task-name">
        <a href="{{ url_for('elaborateTask', tid=task.tid) }}">{{ task.task }}</a>
      </div>

      <div class="task-options">

        <form action="{{ url_for('markIncomplete', tid=task.tid) }}" method="POST">
          <button type="submit">Mark Incomplete</button>
        </form>

        <form action="{{ url_for('markWorkingOn', tid=task.tid) }}" method="POST">
          <button type="submit">Mark Working</button>
        </form>

        <form action="{{ url_for('deleteTask', tid=task.tid) }}" method="POST">
          <button type="submit">Remove</button>
        </form>

      </div>
    </li>
  {% endfor %}
{% endif %}

<h2>List Options</h2>

<div style="text-align: center;">
  {% if completedTasks %}
    <form action="{{ url_for('clearCompletedTasks', username=user.username) }}" method="POST" style="text-align: centre;">
      <button type="submit">Clear All Completed Tasks</button>
    </form>
  {% endif %}

  {% if workingOnTasks %}
    <form action="{{ url_for('clearWorkingOnTasks', username=user.username) }}" method="POST" style="text-align: centre;">
      <button type="submit">Clear All Working On Tasks</button>
    </form>
  {% endif %}

  {% if remainingTasks or workingOnTasks or completedTasks %}
    <form action="{{ url_for('clearAllTasks', username=user.username) }}" method="POST" style="text-align: centre;">
      <button type="submit">Clear All Tasks</button>
    </form>
  {% endif %}

  <form action="{{ url_for('homePage') }}" method="GET" style="text-align: centre;">
    <button type="submit">Return to Home Page</button>
  </form>
</div>

<form action="{{ url_for('logout') }}" method="GET" style="margin-top: 20px;">
  <button type="submit">Logout</button>
</form>

<script>
  setTimeout(() => {
    const flash = document.getElementById('flashed-message');
    if (flash) {
      flash.style.display = 'none';
    }
  }, 3000);
</script>

{% endblock %}